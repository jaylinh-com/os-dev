<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>5.编写，构建，加载你的内核 | 手写一个简单的操作系统</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="本项目设计的目的不是替代像Minix这样的优秀项目，而是作为学习这些优秀项目以及开发操作系统的垫脚石。">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/os-dev/assets/css/0.styles.f631a23c.css" as="style"><link rel="preload" href="/os-dev/assets/js/app.94cc796a.js" as="script"><link rel="preload" href="/os-dev/assets/js/2.0c2d34ad.js" as="script"><link rel="preload" href="/os-dev/assets/js/15.8bf2994f.js" as="script"><link rel="prefetch" href="/os-dev/assets/js/10.e27cce2f.js"><link rel="prefetch" href="/os-dev/assets/js/11.f2c44194.js"><link rel="prefetch" href="/os-dev/assets/js/12.0fd31076.js"><link rel="prefetch" href="/os-dev/assets/js/13.d859aef3.js"><link rel="prefetch" href="/os-dev/assets/js/14.b877ec74.js"><link rel="prefetch" href="/os-dev/assets/js/16.e3c80264.js"><link rel="prefetch" href="/os-dev/assets/js/17.b5a31018.js"><link rel="prefetch" href="/os-dev/assets/js/18.d1a38ccf.js"><link rel="prefetch" href="/os-dev/assets/js/19.4dee656e.js"><link rel="prefetch" href="/os-dev/assets/js/20.a922bbe5.js"><link rel="prefetch" href="/os-dev/assets/js/21.82e6a581.js"><link rel="prefetch" href="/os-dev/assets/js/22.c9e2e827.js"><link rel="prefetch" href="/os-dev/assets/js/3.8ab27593.js"><link rel="prefetch" href="/os-dev/assets/js/4.880e7f6b.js"><link rel="prefetch" href="/os-dev/assets/js/5.31ed563c.js"><link rel="prefetch" href="/os-dev/assets/js/6.73c063ed.js"><link rel="prefetch" href="/os-dev/assets/js/7.294a7cdc.js"><link rel="prefetch" href="/os-dev/assets/js/8.64f2d825.js"><link rel="prefetch" href="/os-dev/assets/js/9.3112df6c.js">
    <link rel="stylesheet" href="/os-dev/assets/css/0.styles.f631a23c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/os-dev/" class="home-link router-link-active"><!----> <span class="site-name">手写一个简单的操作系统</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/os-dev/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/os-dev/doc/introduction.html" class="nav-link">
  文档
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="切换语言Switch Languages" class="dropdown-title"><span class="title">切换语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="切换语言Switch Languages" class="mobile-dropdown-title"><span class="title">切换语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/os-dev/doc/writing-building-and-loading-your-kernel.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  中文
</a></li><li class="dropdown-item"><!----> <a href="/os-dev/en-US/" class="nav-link">
  English
</a></li></ul></div></div> <a href="https://github.com/jaylinh-com/os-dev" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/os-dev/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/os-dev/doc/introduction.html" class="nav-link">
  文档
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="切换语言Switch Languages" class="dropdown-title"><span class="title">切换语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="切换语言Switch Languages" class="mobile-dropdown-title"><span class="title">切换语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/os-dev/doc/writing-building-and-loading-your-kernel.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  中文
</a></li><li class="dropdown-item"><!----> <a href="/os-dev/en-US/" class="nav-link">
  English
</a></li></ul></div></div> <a href="https://github.com/jaylinh-com/os-dev" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/os-dev/doc/introduction.html" class="sidebar-link">1. 介绍</a></li><li><a href="/os-dev/doc/computer-architecture-and-the-boot-process.html" class="sidebar-link">2. 计算机体系结构与引导流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/os-dev/doc/computer-architecture-and-the-boot-process.html#_2-1-引导流程" class="sidebar-link">2.1 引导流程</a></li><li class="sidebar-sub-header"><a href="/os-dev/doc/computer-architecture-and-the-boot-process.html#_2-2-bios-引导区-魔法数字" class="sidebar-link">2.2 BIOS, 引导区，魔法数字</a></li><li class="sidebar-sub-header"><a href="/os-dev/doc/computer-architecture-and-the-boot-process.html#_2-3-cpu-模拟" class="sidebar-link">2.3 CPU 模拟</a></li><li class="sidebar-sub-header"><a href="/os-dev/doc/computer-architecture-and-the-boot-process.html#_2-4-十六进制表示法的优势" class="sidebar-link">2.4 十六进制表示法的优势</a></li></ul></li><li><a href="/os-dev/doc/boot-sector-programming.html" class="sidebar-link">3. 引导扇区编程（16位实模式）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/os-dev/doc/boot-sector-programming.html#_3-1-回顾引导扇区" class="sidebar-link">3.1 回顾引导扇区</a></li><li class="sidebar-sub-header"><a href="/os-dev/doc/boot-sector-programming.html#_3-2-16位实模式" class="sidebar-link">3.2 16位实模式</a></li><li class="sidebar-sub-header"><a href="/os-dev/doc/boot-sector-programming.html#_3-3-嗯-hello" class="sidebar-link">3.3 嗯， Hello ?</a></li><li class="sidebar-sub-header"><a href="/os-dev/doc/boot-sector-programming.html#_3-4-hello-world" class="sidebar-link">3.4 Hello World!</a></li><li class="sidebar-sub-header"><a href="/os-dev/doc/boot-sector-programming.html#_3-5-护士-把我的停诊器拿给我" class="sidebar-link">3.5 护士, 把我的停诊器拿给我</a></li><li class="sidebar-sub-header"><a href="/os-dev/doc/boot-sector-programming.html#_3-6-读取磁盘" class="sidebar-link">3.6 读取磁盘</a></li></ul></li><li><a href="/os-dev/doc/entering-32-bit-protected-mode.html" class="sidebar-link">4. 进入 32 位保护模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/os-dev/doc/entering-32-bit-protected-mode.html#_4-1-适应没有-bios-的生活" class="sidebar-link">4.1 适应没有 BIOS 的生活</a></li><li class="sidebar-sub-header"><a href="/os-dev/doc/entering-32-bit-protected-mode.html#_4-2-理解全局描述符表-global-descriptor-table" class="sidebar-link">4.2 理解全局描述符表(Global Descriptor Table)</a></li><li class="sidebar-sub-header"><a href="/os-dev/doc/entering-32-bit-protected-mode.html#_4-3-使用汇编语言定义gdt" class="sidebar-link">4.3 使用汇编语言定义GDT</a></li><li class="sidebar-sub-header"><a href="/os-dev/doc/entering-32-bit-protected-mode.html#_4-4-开始切换" class="sidebar-link">4.4 开始切换</a></li><li class="sidebar-sub-header"><a href="/os-dev/doc/entering-32-bit-protected-mode.html#_4-5-综合使用" class="sidebar-link">4.5 综合使用</a></li></ul></li><li><a href="/os-dev/doc/writing-building-and-loading-your-kernel.html" aria-current="page" class="active sidebar-link">5.编写，构建，加载你的内核</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_5-编写-构建-加载你的内核"><a href="#_5-编写-构建-加载你的内核" class="header-anchor">#</a> 5.编写，构建，加载你的内核</h1> <p>So far, we have learnt a lot about how the computer really works, by communicating with it in the low-level assembly language, but we’ve also seen how it can be very slow to progress in such a language: we need to think very carefully even about the simplest of control structures (e.g. if <code>(&lt;something&gt;) &lt;do this&gt; else &lt;do that&gt;)</code>, and we have to worry about how best to make use of the limited number of registers, and juggle with the stack. Another drawback of us continuing in assembly language is that it is closely tied to the specific CPU architecture, and so it would be harder for us to port our operating system to another CPU architecture (e.g. ARM, RISC, PowerPC).
Luckily, other programmers also got fed up of writing in assembly, so decided to write higher-level language compilers (e.g. FORTRAN, C, Pascal, BASIC, etc.), that would transform more intuitive code into assembly language. The idea of these compilers is to map higher level constructs, such as control structures and function calls onto assembly template code, and so the downside --- and there usually always is a downside --- is that the generic templates may not always be optimal for specific functionality. Without further ado, let us look at how C code is transformed into assembly to demystify the role of the compiler.</p> <p>目前，我们已经学习了关于计算机怎么工作的</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最近更新:</span> <span class="time">2021/1/3 上午7:08:54</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/os-dev/doc/entering-32-bit-protected-mode.html" class="prev">
        4. 进入 32 位保护模式
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/os-dev/assets/js/app.94cc796a.js" defer></script><script src="/os-dev/assets/js/2.0c2d34ad.js" defer></script><script src="/os-dev/assets/js/15.8bf2994f.js" defer></script>
  </body>
</html>
